import{r as l,k as x,b as d,c as m,m as a,n as p,v as k,B as _,p as w,g as y,d as F,q as C,w as B,A as j,F as D,h as b}from"./index.8604c9ce.js";import{b as V}from"./post.996a5748.js";import{a as z}from"./file.ff7704d2.js";import{s as N,g as S}from"./swal.db038e00.js";const U=a("h2",{class:"relative isolate mb-4 after:absolute after:right-1 after:top-1 after:z-[-1] after:h-full after:w-full after:border-2 after:border-black-100 after:content-['']"},[a("div",{class:"border-2 border-black-100 bg-white py-[18px] text-center font-azeret text-xl font-bold text-black-100"}," \u5F35\u8CBC\u52D5\u614B ")],-1),A=a("label",{for:"content",class:"mb-1 inline-block text-black-100"},"\u8CBC\u6587\u5167\u5BB9",-1),E={class:"relative mt-4 inline-block cursor-pointer rounded bg-black-100 py-1 px-8 text-white"},I=b(" \u4E0A\u50B3\u5716\u7247 "),M=["src"],P={key:0,class:"mt-8 text-center text-sm text-red-100","data-id":"error"},R=b("\u9001\u51FA\u8CBC\u6587"),G={setup(T){const i=l(!1),s=l(""),n=l(""),o=l(""),c=l(null),u=l(null),f=t=>{const e=t.target.files.item(0);if(o.value="",!["image/jpeg","image/png"].includes(e.type)){o.value="\u6A94\u6848\u683C\u5F0F\u932F\u8AA4\uFF0C\u50C5\u9650\u4E0A\u50B3 jpg\u3001jpeg \u8207 png \u683C\u5F0F",u.value.value="";return}const r=new FileReader;r.readAsDataURL(e),r.onload=()=>{n.value=r.result,c.value=e}},v=async()=>{try{const t=new FormData;t.append("image",c.value);const{data:e}=await z(t);return e}catch(t){return Promise.reject(t)}},g=async()=>{i.value=!0;try{let t="";c.value&&(t=await v());const e={content:s.value};t&&(e.image=t),await V(e),s.value="",n.value="",o.value="",u.value.value="",c.value=null,N({title:"\u65B0\u589E\u8CBC\u6587\u6210\u529F"})}catch(t){const e=S(t.message);o.value=e}finally{i.value=!1}};return(t,e)=>{const r=x("Button");return d(),m(D,null,[U,a("form",{method:"post",class:"rounded-lg border-2 border-black-100 p-8 shadow-100",onSubmit:e[1]||(e[1]=j(()=>{},["prevent"]))},[A,p(a("textarea",{"onUpdate:modelValue":e[0]||(e[0]=h=>s.value=h),class:"block min-h-[169px] w-full border-2 border-black-100 py-3 px-4",placeholder:"\u8F38\u5165\u60A8\u7684\u8CBC\u6587\u5167\u5BB9"},null,512),[[k,s.value,void 0,{trim:!0}]]),a("label",E,[a("input",{ref_key:"inputFile",ref:u,type:"file",class:"sr-only",accept:"image/*",onChange:f},null,544),I]),p(a("img",{src:n.value,alt:"post image",class:"mt-4 rounded-lg object-cover"},null,8,M),[[_,n.value]]),o.value?(d(),m("p",P,w(o.value),1)):y("",!0),F(r,{class:C(["mx-auto block w-[68.86%] rounded-lg border-2 border-black-100 bg-gray-200 font-azeret font-bold leading-[50px] text-black-100 hover:bg-yellow-100 hover:shadow-200",o.value?"mt-4":"mt-8"]),loading:i.value,onClick:g},{default:B(()=>[R]),_:1},8,["class","loading"])],32)],64)}}};export{G as default};
