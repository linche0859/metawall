import{r as l,o as B,a as S,b as s,c as i,d as y,e as d,w,F as f,T as D,_ as N,f as T,g as V,h as $,i as F,u as h}from"./index.dcc6c3e3.js";import{_ as I,p as K,d as j,a as q,b as G,c as U}from"./PostCard.87ea0334.js";import{E as k}from"./EmptyPostCard.6bfd91e8.js";import{_ as W}from"./PostFilter.f6efaed8.js";import"./dompurify.94300d41.js";import"./swal.5a8fdb95.js";import"./plugin-vue_export-helper.21dcd24c.js";const Y=$("\u8F09\u5165\u4E2D..."),z={key:2,class:"mt-5 flex justify-center"},ae={setup(A){const n=l(!0),o=l(!1),v=l("desc"),m=l(""),p=l(1),a=l([]),u=l({}),g=async()=>{const{data:e}=await F({sort:v.value,q:m.value,page:p.value});return e},c=async({isScrolling:e=!1,reset:t=!1}={})=>{try{e?o.value=!0:n.value=!0,t&&(p.value=1,a.value=[]);const{data:r,meta:b}=await g();a.value.push(...r),u.value=b}finally{n.value=!1,o.value=!1}},P=e=>{v.value=e,c({reset:!0})},L=e=>{m.value=e,c({reset:!0})},H=e=>{K({postId:e,userId:h.value._id,posts:a.value})},M=e=>{j({postId:e,userId:h.value._id,posts:a.value})},x=({postId:e,message:t})=>{q({postId:e,message:t,posts:a.value})},C=(e,t)=>{G({postId:t,messageId:e,posts:a.value})},E=e=>{U({postId:e,posts:a.value},async()=>{if(!n.value&&!o.value&&a.value.length<u.value.total-1)try{o.value=!0;const{data:t,meta:r}=await g();a.value.push(t.pop()),u.value=r}finally{o.value=!1}})},_=()=>{n.value||o.value||u.value.currentPage>=u.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(p.value++,c({isScrolling:!0}))};return B(()=>{window.history.replaceState({},document.title,location.pathname),window.addEventListener("scroll",_)}),S(()=>{window.removeEventListener("scroll",_)}),c(),(e,t)=>(s(),i(f,null,[y(W,{class:"mb-4",loading:n.value,sort:v.value,onChangeSort:P,onChangeKeyword:L},null,8,["loading","sort"]),n.value?(s(),d(k,{key:0},{default:w(()=>[Y]),_:1})):(s(),i(f,{key:1},[a.value.length?(s(),d(D,{key:0,tag:"ul",name:"fade",class:"space-y-4"},{default:w(()=>[(s(!0),i(f,null,V(a.value,r=>(s(),d(I,{key:r._id,post:r,onPostLike:H,onPostMessage:x,onDeleteLike:M,onDeletePost:E,onDeleteMessage:C},null,8,["post"]))),128))]),_:1})):(s(),d(k,{key:1}))],64)),o.value?(s(),i("div",z,[y(N,{color:"text-primary"})])):T("",!0)],64))}};export{ae as default};
