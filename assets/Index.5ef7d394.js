import{g as E,d as M}from"./post.1ee4ca00.js";import{_ as B,a as D,p as N,d as S,b as V}from"./PostFilter.acd16b42.js";import{r as n,o as $,a as F,b as s,c,d as h,e as p,w as I,F as m,f as K,_ as j,g as q,h as T,i as U}from"./index.c1863373.js";import{E as k}from"./EmptyPostCard.f50398cb.js";import"./swal.db038e00.js";import"./plugin-vue_export-helper.21dcd24c.js";const W=T("\u8F09\u5165\u4E2D..."),Y={key:0,class:"space-y-4"},z={key:2,class:"mt-5 flex justify-center"},Z={setup(A){const r=n(!0),o=n(!1),d=n("desc"),g=n(""),v=n(1),a=n([]),u=n({}),{user:_}=U(),y=async()=>{const{data:e}=await E({sort:d.value,q:g.value,page:v.value});return e},i=async({isScrolling:e=!1,reset:l=!1}={})=>{try{e?o.value=!0:r.value=!0,l&&(v.value=1,a.value=[]);const{data:t,meta:f}=await y();a.value.push(...t),u.value=f}finally{r.value=!1,o.value=!1}},P=e=>{d.value=e,i({reset:!0})},L=e=>{g.value=e,i({reset:!0})},x=e=>{N({postId:e,userId:_.value._id,posts:a.value})},H=e=>{S({postId:e,userId:_.value._id,posts:a.value})},b=({postId:e,message:l})=>{V({postId:e,message:l,posts:a.value})},C=async e=>{const l=a.value.findIndex(t=>t._id===e);if(~l&&a.value.splice(l,1),await M(e),!r.value&&!o.value&&a.value.length<u.value.total)try{o.value=!0;const{data:t,meta:f}=await y();a.value.push(t.pop()),u.value=f}finally{o.value=!1}},w=()=>{r.value||o.value||u.value.currentPage>=u.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(v.value++,i({isScrolling:!0}))};return $(()=>{window.addEventListener("scroll",w)}),F(()=>{window.removeEventListener("scroll",w)}),i(),(e,l)=>(s(),c(m,null,[h(B,{class:"mb-4",loading:r.value,sort:d.value,onChangeSort:P,onChangeKeyword:L},null,8,["loading","sort"]),r.value?(s(),p(k,{key:0},{default:I(()=>[W]),_:1})):(s(),c(m,{key:1},[a.value.length?(s(),c("ul",Y,[(s(!0),c(m,null,K(a.value,t=>(s(),p(D,{key:t._id,post:t,onPostLike:x,onPostMessage:b,onDeleteLike:H,onDeletePost:C},null,8,["post"]))),128))])):(s(),p(k,{key:1}))],64)),o.value?(s(),c("div",z,[h(j,{color:"text-primary"})])):q("",!0)],64))}};export{Z as default};
