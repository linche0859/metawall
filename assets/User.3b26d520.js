import{r as n,I as D,J as K,j as U,o as a,c,k as r,p as L,F as v,l as $,m as h,u as g,n as q,a as z,b as y,d as F,e as J,f as B,g as R,K as A}from"./index.b74ca7ef.js";import{e as G}from"./post.a9b6f0c8.js";import{g as O,d as Q,p as W}from"./track.49727e1d.js";import{s as X,g as Y}from"./swal.db038e00.js";import{_ as Z,a as ee,p as ae,d as se,b as te}from"./PostFilter.03d57d53.js";import{E as P}from"./EmptyPostCard.87290b8e.js";import"./plugin-vue_export-helper.21dcd24c.js";const re=(m=0)=>m.toString().replace(/\B(?=(\d{3})+$)/g,","),oe={class:"relative isolate mb-4 after:absolute after:right-1 after:top-1 after:z-[-1] after:h-full after:w-full after:rounded-lg after:border-2 after:border-black-100 after:content-['']"},le=B("\u8F09\u5165\u4E2D..."),ne={class:"min-h-[80px] w-[20%] flex-shrink-0 border-r-2 border-black-100 lg:w-[15%]"},ce=["src"],de={class:"flex flex-grow items-center p-4"},ie={class:"flex-grow pr-5"},ue={class:"font-bold"},ve=B("\u8F09\u5165\u4E2D..."),fe={key:0,class:"space-y-5"},ye={props:{userId:{type:String,required:!0}},setup(m){const s=m,f=n(!1),d=n(!1),k=n("desc"),w=n(""),u=n([]),o=n([]),l=n({}),{user:_}=R(),S=D(()=>_.value._id===s.userId),b=D(()=>u.value.some(e=>e._id===s.userId)),x=async e=>{try{f.value=!0,d.value=!0;const[t,i,p]=await Promise.all([O(),A(e),I(e)]);u.value=t.data.map(j=>j.tracking),l.value=i.data,o.value=p.data}finally{f.value=!1,d.value=!1}},I=async e=>await G(e,{sort:k.value,q:w.value}),C=async()=>{d.value=!0;const{data:e}=await I(s.userId);o.value=e,d.value=!1},T=()=>{try{if(b.value){Q(s.userId);const e=u.value.findIndex(t=>t._id===s.userId);u.value.splice(e,1),l.value.tracking--}else W(s.userId),u.value.push(l.value),l.value.tracking++}catch(e){X({title:Y(e.message),icon:"error"})}},E=e=>{ae({postId:e,userId:_.value._id,posts:o.value})},H=e=>{se({postId:e,userId:_.value._id,posts:o.value})},M=({postId:e,message:t})=>{te({postId:e,message:t,posts:o.value})},N=e=>{k.value=e,C()},V=e=>{w.value=e,C()};return K((e,t)=>{const{params:{userId:i}}=e;s.userId!==i&&x(i)}),x(s.userId),(e,t)=>{const i=U("img-avatar-fallback");return a(),c(v,null,[r("div",oe,[r("div",{class:L(["flex rounded-lg border-2 border-black-100 bg-white",{"min-h-[80px] items-center justify-center":f.value}])},[f.value?(a(),c(v,{key:0},[le],64)):(a(),c(v,{key:1},[r("div",ne,[$(r("img",{src:l.value.avatar,class:"h-full w-full rounded-l-lg object-cover",alt:"avatar"},null,8,ce),[[i]])]),r("div",de,[r("div",ie,[r("div",ue,h(l.value.name),1),r("p",null,h(g(re)(l.value.tracking))+" \u4EBA\u8FFD\u8E64",1)]),g(S)?q("",!0):(a(),c("button",{key:0,class:L(["flex-shrink-0 rounded-lg border-2 border-black-100 px-8 font-bold leading-8 text-black-100 shadow-200",g(b)?"bg-secondary":"bg-yellow-100"]),onClick:T},h(g(b)?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3))])],64))],2)]),z(Z,{class:"mb-4",loading:d.value,sort:k.value,onChangeSort:N,onChangeKeyword:V},null,8,["loading","sort"]),d.value?(a(),y(P,{key:0},{default:F(()=>[ve]),_:1})):(a(),c(v,{key:1},[o.value.length?(a(),c("ul",fe,[(a(!0),c(v,null,J(o.value,p=>(a(),y(ee,{key:p._id,post:p,onPostLike:E,onPostMessage:M,onDeleteLike:H},null,8,["post"]))),128))])):(a(),y(P,{key:1}))],64))],64)}}};export{ye as default};
