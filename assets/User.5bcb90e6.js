import{r,p as M,u as P,W as R,o as X,a as A,s as J,b as t,c as v,k as u,n as T,F as g,l as O,y as L,x as k,f as B,d as S,e as h,w as E,T as Q,_ as Z,h as N,X as ee,Y as ae,g as se}from"./index.40ed2a54.js";import{g as te,d as le,p as re}from"./track.9ee79066.js";import{s as oe,g as ne}from"./swal.5a8fdb95.js";import{_ as ue,p as ce,d as ie,c as de,a as ve,b as fe}from"./PostCard.3843ca94.js";import{_ as pe}from"./PostFilter.4b648b0d.js";import{E as $}from"./EmptyPostCard.845532c6.js";import"./dompurify.94300d41.js";import"./plugin-vue_export-helper.21dcd24c.js";const ge=(y=0)=>y.toString().replace(/\B(?=(\d{3})+$)/g,","),me={class:"relative isolate mb-4 after:absolute after:right-1 after:top-1 after:z-[-1] after:h-full after:w-full after:rounded-lg after:border-2 after:border-black-100 after:content-['']"},_e=N("\u8F09\u5165\u4E2D..."),ke={class:"min-h-[80px] w-[20%] flex-shrink-0 border-r-2 border-black-100 lg:w-[15%]"},he=["src"],ye={class:"flex flex-grow items-center p-4"},we={class:"flex-grow pr-5"},be={class:"font-bold"},xe=N("\u8F09\u5165\u4E2D..."),Ie={key:2,class:"mt-5 flex justify-center"},Se={props:{userId:{type:String,required:!0}},setup(y){const o=y,m=r(!1),n=r(!1),c=r(!1),w=r("desc"),D=r(""),_=r(1),p=r([]),s=r([]),i=r({}),f=r({}),U=M(()=>P.value._id===o.userId),b=M(()=>p.value.some(e=>e._id===o.userId)),C=async e=>{try{m.value=!0,n.value=!0;const[a,l,d]=await Promise.all([te(),ee(e),x(e)]);p.value=a.data.map(G=>G.tracking),i.value=l.data,s.value=d.data,f.value=d.meta}finally{m.value=!1,n.value=!1}},x=async e=>{const{data:a}=await ae(e,{sort:w.value,q:D.value,page:_.value});return a},I=async({isScrolling:e=!1,reset:a=!1}={})=>{try{e?c.value=!0:n.value=!0,a&&(_.value=1,s.value=[]);const{data:l,meta:d}=await x(o.userId);s.value.push(...l),f.value=d}finally{n.value=!1,c.value=!1}},V=()=>{try{if(b.value){le(o.userId);const e=p.value.findIndex(a=>a._id===o.userId);p.value.splice(e,1),i.value.tracking--}else re(o.userId),p.value.push(i.value),i.value.tracking++}catch(e){oe({title:ne(e.message),icon:"error"})}},j=e=>{ce({postId:e,userId:P.value._id,posts:s.value})},q=e=>{ie({postId:e,userId:P.value._id,posts:s.value})},z=e=>{de({postId:e,posts:s.value},async()=>{if(!n.value&&!c.value&&s.value.length<f.value.total-1)try{c.value=!0;const{data:a,meta:l}=await x(o.userId);s.value.push(a.pop()),f.value=l}finally{c.value=!1}})},F=({postId:e,message:a})=>{ve({postId:e,message:a,posts:s.value})},K=(e,a)=>{fe({postId:a,messageId:e,posts:s.value})},W=e=>{w.value=e,I({reset:!0})},Y=e=>{D.value=e,I({reset:!0})},H=()=>{n.value||c.value||f.value.currentPage>=f.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(_.value++,I({isScrolling:!0}))};return R((e,a)=>{const{params:{userId:l}}=e;o.userId!==l&&(_.value=1,C(l))}),X(()=>{window.addEventListener("scroll",H)}),A(()=>{window.removeEventListener("scroll",H)}),C(o.userId),(e,a)=>{const l=J("img-avatar-fallback");return t(),v(g,null,[u("div",me,[u("div",{class:T(["flex rounded-lg border-2 border-black-100 bg-white",{"min-h-[80px] items-center justify-center":m.value}])},[m.value?(t(),v(g,{key:0},[_e],64)):(t(),v(g,{key:1},[u("div",ke,[O(u("img",{src:i.value.avatar,class:"h-full w-full rounded-l-lg object-cover",alt:"avatar"},null,8,he),[[l]])]),u("div",ye,[u("div",we,[u("div",be,L(i.value.name),1),u("p",null,L(k(ge)(i.value.tracking))+" \u4EBA\u8FFD\u8E64",1)]),k(U)?B("",!0):(t(),v("button",{key:0,class:T(["flex-shrink-0 rounded-lg border-2 border-black-100 px-8 font-bold leading-8 text-black-100 shadow-200",k(b)?"bg-secondary":"bg-yellow-100"]),onClick:V},L(k(b)?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3))])],64))],2)]),S(pe,{class:"mb-4",loading:n.value,sort:w.value,onChangeSort:W,onChangeKeyword:Y},null,8,["loading","sort"]),n.value?(t(),h($,{key:0},{default:E(()=>[xe]),_:1})):(t(),v(g,{key:1},[s.value.length?(t(),h(Q,{key:0,tag:"ul",name:"fade",class:"space-y-5"},{default:E(()=>[(t(!0),v(g,null,se(s.value,d=>(t(),h(ue,{key:d._id,post:d,onPostLike:j,onPostMessage:F,onDeleteLike:q,onDeletePost:z,onDeleteMessage:K},null,8,["post"]))),128))]),_:1})):(t(),h($,{key:1}))],64)),c.value?(t(),v("div",Ie,[S(Z,{color:"text-primary"})])):B("",!0)],64)}}};export{Se as default};
