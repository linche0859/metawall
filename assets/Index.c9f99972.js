import{r as n,o as S,a as D,b as o,c as d,d as h,e as v,w as k,F as g,T as N,_ as T,f as V,g as $,h as F,u as P}from"./index.c0c28979.js";import{g as I,d as K,a as j}from"./post.2720bc85.js";import{_ as q,a as G,p as U,d as W,b as Y}from"./PostFilter.5da0f865.js";import{E as x}from"./EmptyPostCard.d587914f.js";import"./swal.5a8fdb95.js";import"./plugin-vue_export-helper.21dcd24c.js";const z=F("\u8F09\u5165\u4E2D..."),A={key:2,class:"mt-5 flex justify-center"},ae={setup(J){const r=n(!0),l=n(!1),f=n("desc"),_=n(""),p=n(1),a=n([]),i=n({}),y=async()=>{const{data:e}=await I({sort:f.value,q:_.value,page:p.value});return e},c=async({isScrolling:e=!1,reset:s=!1}={})=>{try{e?l.value=!0:r.value=!0,s&&(p.value=1,a.value=[]);const{data:t,meta:u}=await y();a.value.push(...t),i.value=u}finally{r.value=!1,l.value=!1}},L=e=>{f.value=e,c({reset:!0})},H=e=>{_.value=e,c({reset:!0})},M=e=>{U({postId:e,userId:P.value._id,posts:a.value})},C=e=>{W({postId:e,userId:P.value._id,posts:a.value})},E=({postId:e,message:s})=>{Y({postId:e,message:s,posts:a.value})},b=async e=>{const s=a.value.findIndex(t=>t._id===e);if(~s&&a.value.splice(s,1),await K(e),!r.value&&!l.value&&a.value.length<i.value.total-1)try{l.value=!0;const{data:t,meta:u}=await y();a.value.push(t.pop()),i.value=u}finally{l.value=!1}},B=async(e,s)=>{const t=a.value.find(m=>m._id===s),u=t.messages.findIndex(m=>m._id===e);~u&&t.messages.splice(u,1),await j(e)},w=()=>{r.value||l.value||i.value.currentPage>=i.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(p.value++,c({isScrolling:!0}))};return S(()=>{window.history.replaceState({},document.title,location.pathname),window.addEventListener("scroll",w)}),D(()=>{window.removeEventListener("scroll",w)}),c(),(e,s)=>(o(),d(g,null,[h(q,{class:"mb-4",loading:r.value,sort:f.value,onChangeSort:L,onChangeKeyword:H},null,8,["loading","sort"]),r.value?(o(),v(x,{key:0},{default:k(()=>[z]),_:1})):(o(),d(g,{key:1},[a.value.length?(o(),v(N,{key:0,tag:"ul",name:"fade",class:"space-y-4"},{default:k(()=>[(o(!0),d(g,null,$(a.value,t=>(o(),v(G,{key:t._id,post:t,onPostLike:M,onPostMessage:E,onDeleteLike:C,onDeletePost:b,onDeleteMessage:B},null,8,["post"]))),128))]),_:1})):(o(),v(x,{key:1}))],64)),l.value?(o(),d("div",A,[h(T,{color:"text-primary"})])):V("",!0)],64))}};export{ae as default};
