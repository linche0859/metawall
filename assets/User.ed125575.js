import{r as s,p as H,K as R,o as W,a as Y,s as A,b as a,c as n,k as c,n as S,F as f,l as G,x as I,u as k,g as E,d as M,e as L,w as J,f as O,_ as Q,h as N,i as X,L as Z}from"./index.e74b4c15.js";import{f as ee}from"./post.9efae258.js";import{g as ae,d as te,p as se}from"./track.290c2763.js";import{s as re,g as oe}from"./swal.db038e00.js";import{_ as le,a as ne,p as ce,d as ie,b as ue}from"./PostFilter.33603ccb.js";import{E as T}from"./EmptyPostCard.3eaa0653.js";import"./plugin-vue_export-helper.21dcd24c.js";const de=(h=0)=>h.toString().replace(/\B(?=(\d{3})+$)/g,","),ve={class:"relative isolate mb-4 after:absolute after:right-1 after:top-1 after:z-[-1] after:h-full after:w-full after:rounded-lg after:border-2 after:border-black-100 after:content-['']"},fe=N("\u8F09\u5165\u4E2D..."),ge={class:"min-h-[80px] w-[20%] flex-shrink-0 border-r-2 border-black-100 lg:w-[15%]"},pe=["src"],me={class:"flex flex-grow items-center p-4"},_e={class:"flex-grow pr-5"},ke={class:"font-bold"},he=N("\u8F09\u5165\u4E2D..."),ye={key:0,class:"space-y-5"},be={key:2,class:"mt-5 flex justify-center"},Be={props:{userId:{type:String,required:!0}},setup(h){const r=h,g=s(!1),i=s(!1),p=s(!1),y=s("desc"),P=s(""),m=s(1),v=s([]),o=s([]),u=s({}),_=s({}),{user:b}=X(),U=H(()=>b.value._id===r.userId),w=H(()=>v.value.some(e=>e._id===r.userId)),C=async e=>{try{g.value=!0,i.value=!0;const[t,l,d]=await Promise.all([ae(),Z(e),D(e)]);v.value=t.data.map(F=>F.tracking),u.value=l.data,o.value=d.data.data,_.value=d.data.meta}finally{g.value=!1,i.value=!1}},D=async e=>await ee(e,{sort:y.value,q:P.value,page:m.value}),x=async({isScrolling:e=!1,reset:t=!1}={})=>{try{e?p.value=!0:i.value=!0,t&&(m.value=1,o.value=[]);const{data:{data:l,meta:d}}=await D(r.userId);o.value.push(...l),_.value=d}finally{i.value=!1,p.value=!1}},V=()=>{try{if(w.value){te(r.userId);const e=v.value.findIndex(t=>t._id===r.userId);v.value.splice(e,1),u.value.tracking--}else se(r.userId),v.value.push(u.value),u.value.tracking++}catch(e){re({title:oe(e.message),icon:"error"})}},$=e=>{ce({postId:e,userId:b.value._id,posts:o.value})},j=e=>{ie({postId:e,userId:b.value._id,posts:o.value})},K=({postId:e,message:t})=>{ue({postId:e,message:t,posts:o.value})},q=e=>{y.value=e,x({reset:!0})},z=e=>{P.value=e,x({reset:!0})},B=()=>{i.value||p.value||_.value.currentPage>=_.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(m.value++,x({isScrolling:!0}))};return R((e,t)=>{const{params:{userId:l}}=e;r.userId!==l&&(m.value=1,C(l))}),W(()=>{window.addEventListener("scroll",B)}),Y(()=>{window.removeEventListener("scroll",B)}),C(r.userId),(e,t)=>{const l=A("img-avatar-fallback");return a(),n(f,null,[c("div",ve,[c("div",{class:S(["flex rounded-lg border-2 border-black-100 bg-white",{"min-h-[80px] items-center justify-center":g.value}])},[g.value?(a(),n(f,{key:0},[fe],64)):(a(),n(f,{key:1},[c("div",ge,[G(c("img",{src:u.value.avatar,class:"h-full w-full rounded-l-lg object-cover",alt:"avatar"},null,8,pe),[[l]])]),c("div",me,[c("div",_e,[c("div",ke,I(u.value.name),1),c("p",null,I(k(de)(u.value.tracking))+" \u4EBA\u8FFD\u8E64",1)]),k(U)?E("",!0):(a(),n("button",{key:0,class:S(["flex-shrink-0 rounded-lg border-2 border-black-100 px-8 font-bold leading-8 text-black-100 shadow-200",k(w)?"bg-secondary":"bg-yellow-100"]),onClick:V},I(k(w)?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3))])],64))],2)]),M(le,{class:"mb-4",loading:i.value,sort:y.value,onChangeSort:q,onChangeKeyword:z},null,8,["loading","sort"]),i.value?(a(),L(T,{key:0},{default:J(()=>[he]),_:1})):(a(),n(f,{key:1},[o.value.length?(a(),n("ul",ye,[(a(!0),n(f,null,O(o.value,d=>(a(),L(ne,{key:d._id,post:d,onPostLike:$,onPostMessage:K,onDeleteLike:j},null,8,["post"]))),128))])):(a(),L(T,{key:1}))],64)),p.value?(a(),n("div",be,[M(Q,{color:"text-primary"})])):E("",!0)],64)}}};export{Be as default};
