import{g as B,d as D,a as N}from"./post.f8263ef8.js";import{_ as S,a as V,p as $,d as F,b as I}from"./PostFilter.8ac9cc4c.js";import{r as n,o as K,a as j,b as o,c as i,d as k,e as g,w as q,F as m,f as T,_ as U,g as W,h as Y,i as z}from"./index.a4d8b40b.js";import{E as P}from"./EmptyPostCard.cdf9b3e6.js";import"./swal.5a8fdb95.js";import"./plugin-vue_export-helper.21dcd24c.js";const A=Y("\u8F09\u5165\u4E2D..."),G={key:0,class:"space-y-4"},J={key:2,class:"mt-5 flex justify-center"},se={setup(O){const r=n(!0),l=n(!1),v=n("desc"),_=n(""),f=n(1),a=n([]),c=n({}),{user:y}=z(),w=async()=>{const{data:e}=await B({sort:v.value,q:_.value,page:f.value});return e},d=async({isScrolling:e=!1,reset:t=!1}={})=>{try{e?l.value=!0:r.value=!0,t&&(f.value=1,a.value=[]);const{data:s,meta:u}=await w();a.value.push(...s),c.value=u}finally{r.value=!1,l.value=!1}},x=e=>{v.value=e,d({reset:!0})},L=e=>{_.value=e,d({reset:!0})},H=e=>{$({postId:e,userId:y.value._id,posts:a.value})},M=e=>{F({postId:e,userId:y.value._id,posts:a.value})},b=({postId:e,message:t})=>{I({postId:e,message:t,posts:a.value})},C=async e=>{const t=a.value.findIndex(s=>s._id===e);if(~t&&a.value.splice(t,1),await D(e),!r.value&&!l.value&&a.value.length<c.value.total-1)try{l.value=!0;const{data:s,meta:u}=await w();a.value.push(s.pop()),c.value=u}finally{l.value=!1}},E=async(e,t)=>{const s=a.value.find(p=>p._id===t),u=s.messages.findIndex(p=>p._id===e);~u&&s.messages.splice(u,1),await N(e)},h=()=>{r.value||l.value||c.value.currentPage>=c.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(f.value++,d({isScrolling:!0}))};return K(()=>{window.addEventListener("scroll",h)}),j(()=>{window.removeEventListener("scroll",h)}),d(),(e,t)=>(o(),i(m,null,[k(S,{class:"mb-4",loading:r.value,sort:v.value,onChangeSort:x,onChangeKeyword:L},null,8,["loading","sort"]),r.value?(o(),g(P,{key:0},{default:q(()=>[A]),_:1})):(o(),i(m,{key:1},[a.value.length?(o(),i("ul",G,[(o(!0),i(m,null,T(a.value,s=>(o(),g(V,{key:s._id,post:s,onPostLike:H,onPostMessage:b,onDeleteLike:M,onDeletePost:C,onDeleteMessage:E},null,8,["post"]))),128))])):(o(),g(P,{key:1}))],64)),l.value?(o(),i("div",J,[k(U,{color:"text-primary"})])):W("",!0)],64))}};export{se as default};
