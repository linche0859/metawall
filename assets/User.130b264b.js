import{r as o,p as B,K as W,o as Y,a as A,s as G,b as l,c as u,k as i,n as S,F as p,l as J,x as L,u as k,g as E,d as M,e as P,w as O,f as Q,_ as X,h as N,i as Z,L as ee}from"./index.c1863373.js";import{f as ae,d as te}from"./post.1ee4ca00.js";import{g as se,d as le,p as oe}from"./track.7052e687.js";import{s as re,g as ne}from"./swal.db038e00.js";import{_ as ce,a as ue,p as ie,d as de,b as ve}from"./PostFilter.acd16b42.js";import{E as T}from"./EmptyPostCard.f50398cb.js";import"./plugin-vue_export-helper.21dcd24c.js";const fe=(h=0)=>h.toString().replace(/\B(?=(\d{3})+$)/g,","),ge={class:"relative isolate mb-4 after:absolute after:right-1 after:top-1 after:z-[-1] after:h-full after:w-full after:rounded-lg after:border-2 after:border-black-100 after:content-['']"},pe=N("\u8F09\u5165\u4E2D..."),me={class:"min-h-[80px] w-[20%] flex-shrink-0 border-r-2 border-black-100 lg:w-[15%]"},_e=["src"],ke={class:"flex flex-grow items-center p-4"},he={class:"flex-grow pr-5"},ye={class:"font-bold"},we=N("\u8F09\u5165\u4E2D..."),be={key:0,class:"space-y-5"},xe={key:2,class:"mt-5 flex justify-center"},Se={props:{userId:{type:String,required:!0}},setup(h){const r=h,m=o(!1),c=o(!1),d=o(!1),y=o("desc"),D=o(""),_=o(1),g=o([]),t=o([]),v=o({}),f=o({}),{user:w}=Z(),U=B(()=>w.value._id===r.userId),b=B(()=>g.value.some(e=>e._id===r.userId)),C=async e=>{try{m.value=!0,c.value=!0;const[a,s,n]=await Promise.all([se(),ee(e),x(e)]);g.value=a.data.map(R=>R.tracking),v.value=s.data,t.value=n.data,f.value=n.meta}finally{m.value=!1,c.value=!1}},x=async e=>{const{data:a}=await ae(e,{sort:y.value,q:D.value,page:_.value});return a},I=async({isScrolling:e=!1,reset:a=!1}={})=>{try{e?d.value=!0:c.value=!0,a&&(_.value=1,t.value=[]);const{data:s,meta:n}=await x(r.userId);t.value.push(...s),f.value=n}finally{c.value=!1,d.value=!1}},V=()=>{try{if(b.value){le(r.userId);const e=g.value.findIndex(a=>a._id===r.userId);g.value.splice(e,1),v.value.tracking--}else oe(r.userId),g.value.push(v.value),v.value.tracking++}catch(e){re({title:ne(e.message),icon:"error"})}},$=e=>{ie({postId:e,userId:w.value._id,posts:t.value})},j=e=>{de({postId:e,userId:w.value._id,posts:t.value})},K=async e=>{const a=t.value.findIndex(s=>s._id===e);if(~a&&t.value.splice(a,1),await te(e),!c.value&&!d.value&&t.value.length<f.value.total)try{d.value=!0;const{data:s,meta:n}=await x(r.userId);t.value.push(s.pop()),f.value=n}finally{d.value=!1}},q=({postId:e,message:a})=>{ve({postId:e,message:a,posts:t.value})},z=e=>{y.value=e,I({reset:!0})},F=e=>{D.value=e,I({reset:!0})},H=()=>{c.value||d.value||f.value.currentPage>=f.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(_.value++,I({isScrolling:!0}))};return W((e,a)=>{const{params:{userId:s}}=e;r.userId!==s&&(_.value=1,C(s))}),Y(()=>{window.addEventListener("scroll",H)}),A(()=>{window.removeEventListener("scroll",H)}),C(r.userId),(e,a)=>{const s=G("img-avatar-fallback");return l(),u(p,null,[i("div",ge,[i("div",{class:S(["flex rounded-lg border-2 border-black-100 bg-white",{"min-h-[80px] items-center justify-center":m.value}])},[m.value?(l(),u(p,{key:0},[pe],64)):(l(),u(p,{key:1},[i("div",me,[J(i("img",{src:v.value.avatar,class:"h-full w-full rounded-l-lg object-cover",alt:"avatar"},null,8,_e),[[s]])]),i("div",ke,[i("div",he,[i("div",ye,L(v.value.name),1),i("p",null,L(k(fe)(v.value.tracking))+" \u4EBA\u8FFD\u8E64",1)]),k(U)?E("",!0):(l(),u("button",{key:0,class:S(["flex-shrink-0 rounded-lg border-2 border-black-100 px-8 font-bold leading-8 text-black-100 shadow-200",k(b)?"bg-secondary":"bg-yellow-100"]),onClick:V},L(k(b)?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3))])],64))],2)]),M(ce,{class:"mb-4",loading:c.value,sort:y.value,onChangeSort:z,onChangeKeyword:F},null,8,["loading","sort"]),c.value?(l(),P(T,{key:0},{default:O(()=>[we]),_:1})):(l(),u(p,{key:1},[t.value.length?(l(),u("ul",be,[(l(!0),u(p,null,Q(t.value,n=>(l(),P(ue,{key:n._id,post:n,onPostLike:$,onPostMessage:q,onDeleteLike:j,onDeletePost:K},null,8,["post"]))),128))])):(l(),P(T,{key:1}))],64)),d.value?(l(),u("div",xe,[M(X,{color:"text-primary"})])):E("",!0)],64)}}};export{Se as default};
