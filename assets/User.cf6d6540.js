import{r,p as T,K as Y,o as A,a as J,s as O,b as o,c as v,k as i,n as B,F as m,l as Q,x as D,u as h,f as S,d as E,e as y,w as N,T as X,_ as Z,h as V,i as ee,L as ae,g as se}from"./index.54eab09b.js";import{h as te,d as le,a as oe}from"./post.e4a17ccd.js";import{g as re,d as ne,p as ce}from"./track.9e583f4a.js";import{s as ie,g as ue}from"./swal.5a8fdb95.js";import{_ as de,a as ve,p as fe,d as ge,b as pe}from"./PostFilter.ebb3ea78.js";import{E as U}from"./EmptyPostCard.c66de847.js";import"./plugin-vue_export-helper.21dcd24c.js";const me=(w=0)=>w.toString().replace(/\B(?=(\d{3})+$)/g,","),_e={class:"relative isolate mb-4 after:absolute after:right-1 after:top-1 after:z-[-1] after:h-full after:w-full after:rounded-lg after:border-2 after:border-black-100 after:content-['']"},ke=V("\u8F09\u5165\u4E2D..."),he={class:"min-h-[80px] w-[20%] flex-shrink-0 border-r-2 border-black-100 lg:w-[15%]"},ye=["src"],we={class:"flex flex-grow items-center p-4"},be={class:"flex-grow pr-5"},xe={class:"font-bold"},Ie=V("\u8F09\u5165\u4E2D..."),Le={key:2,class:"mt-5 flex justify-center"},Se={props:{userId:{type:String,required:!0}},setup(w){const n=w,_=r(!1),c=r(!1),u=r(!1),b=r("desc"),C=r(""),k=r(1),g=r([]),t=r([]),d=r({}),f=r({}),{user:x}=ee(),$=T(()=>x.value._id===n.userId),I=T(()=>g.value.some(e=>e._id===n.userId)),H=async e=>{try{_.value=!0,c.value=!0;const[a,s,l]=await Promise.all([re(),ae(e),L(e)]);g.value=a.data.map(p=>p.tracking),d.value=s.data,t.value=l.data,f.value=l.meta}finally{_.value=!1,c.value=!1}},L=async e=>{const{data:a}=await te(e,{sort:b.value,q:C.value,page:k.value});return a},P=async({isScrolling:e=!1,reset:a=!1}={})=>{try{e?u.value=!0:c.value=!0,a&&(k.value=1,t.value=[]);const{data:s,meta:l}=await L(n.userId);t.value.push(...s),f.value=l}finally{c.value=!1,u.value=!1}},j=()=>{try{if(I.value){ne(n.userId);const e=g.value.findIndex(a=>a._id===n.userId);g.value.splice(e,1),d.value.tracking--}else ce(n.userId),g.value.push(d.value),d.value.tracking++}catch(e){ie({title:ue(e.message),icon:"error"})}},K=e=>{fe({postId:e,userId:x.value._id,posts:t.value})},q=e=>{ge({postId:e,userId:x.value._id,posts:t.value})},z=async e=>{const a=t.value.findIndex(s=>s._id===e);if(~a&&t.value.splice(a,1),await le(e),!c.value&&!u.value&&t.value.length<f.value.total-1)try{u.value=!0;const{data:s,meta:l}=await L(n.userId);t.value.push(s.pop()),f.value=l}finally{u.value=!1}},F=({postId:e,message:a})=>{pe({postId:e,message:a,posts:t.value})},G=async(e,a)=>{const s=t.value.find(p=>p._id===a),l=s.messages.findIndex(p=>p._id===e);~l&&s.messages.splice(l,1),await oe(e)},R=e=>{b.value=e,P({reset:!0})},W=e=>{C.value=e,P({reset:!0})},M=()=>{c.value||u.value||f.value.currentPage>=f.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(k.value++,P({isScrolling:!0}))};return Y((e,a)=>{const{params:{userId:s}}=e;n.userId!==s&&(k.value=1,H(s))}),A(()=>{window.addEventListener("scroll",M)}),J(()=>{window.removeEventListener("scroll",M)}),H(n.userId),(e,a)=>{const s=O("img-avatar-fallback");return o(),v(m,null,[i("div",_e,[i("div",{class:B(["flex rounded-lg border-2 border-black-100 bg-white",{"min-h-[80px] items-center justify-center":_.value}])},[_.value?(o(),v(m,{key:0},[ke],64)):(o(),v(m,{key:1},[i("div",he,[Q(i("img",{src:d.value.avatar,class:"h-full w-full rounded-l-lg object-cover",alt:"avatar"},null,8,ye),[[s]])]),i("div",we,[i("div",be,[i("div",xe,D(d.value.name),1),i("p",null,D(h(me)(d.value.tracking))+" \u4EBA\u8FFD\u8E64",1)]),h($)?S("",!0):(o(),v("button",{key:0,class:B(["flex-shrink-0 rounded-lg border-2 border-black-100 px-8 font-bold leading-8 text-black-100 shadow-200",h(I)?"bg-secondary":"bg-yellow-100"]),onClick:j},D(h(I)?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3))])],64))],2)]),E(de,{class:"mb-4",loading:c.value,sort:b.value,onChangeSort:R,onChangeKeyword:W},null,8,["loading","sort"]),c.value?(o(),y(U,{key:0},{default:N(()=>[Ie]),_:1})):(o(),v(m,{key:1},[t.value.length?(o(),y(X,{key:0,tag:"ul",name:"fade",class:"space-y-5"},{default:N(()=>[(o(!0),v(m,null,se(t.value,l=>(o(),y(ve,{key:l._id,post:l,onPostLike:K,onPostMessage:F,onDeleteLike:q,onDeletePost:z,onDeleteMessage:G},null,8,["post"]))),128))]),_:1})):(o(),y(U,{key:1}))],64)),u.value?(o(),v("div",Le,[E(Z,{color:"text-primary"})])):S("",!0)],64)}}};export{Se as default};
