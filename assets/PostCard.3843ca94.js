import{j as G,r as M,b as u,c as p,k as e,n as F,l as v,v as R,m as J,t as K,p as Q,u as k,q as L,s as D,x as a,d as y,w as h,h as f,y as m,e as w,z as _,f as g,A as W,F as X,g as Y,T as Z,B as ee,C as T,D as se,E as te}from"./index.40ed2a54.js";import{d as j}from"./EmptyPostCard.845532c6.js";import{D as oe}from"./dompurify.94300d41.js";import{s as b,g as C}from"./swal.5a8fdb95.js";const ts=({postId:r,userId:t,posts:i})=>{i.find(l=>l._id===r).likes.push(t)},os=({postId:r,userId:t,posts:i})=>{const o=i.find(s=>s._id===r),l=o.likes.indexOf(t);~l&&o.likes.splice(l,1)},ls=({postId:r,message:t,posts:i})=>{i.find(l=>l._id===r).messages.unshift(t)},as=({postId:r,messageId:t,posts:i})=>{const o=i.find(s=>s._id===r),l=o.messages.findIndex(s=>s._id===t);~l&&o.messages.splice(l,1)},ns=async({postId:r,posts:t},i=()=>{})=>{const o=t.findIndex(l=>l._id===r);~o&&t.splice(o,1),await G(r),i()},le={class:"relative"},ae=e("i",{class:"fas fa-ellipsis-h"},null,-1),ne=[ae],re={class:"absolute right-0 top-[calc(100%+8px)] z-[1]"},E={setup(r){const t=M(!1);return(i,o)=>(u(),p("div",le,[e("button",{class:F(["block w-10 rounded-full leading-10 text-black-100 hover:bg-secondary",{"bg-secondary":t.value}]),onClick:o[0]||(o[0]=l=>t.value=!0),onFocus:o[1]||(o[1]=l=>t.value=!0),onBlur:o[2]||(o[2]=l=>t.value=!1)},ne,34),v(e("div",re,[J(i.$slots,"default")],512),[[R,t.value]])]))}},ie={class:"rounded-lg border-2 border-black-100 p-6 shadow-100"},ce={class:"mb-4 flex items-center"},de=["src"],ue={class:"flex-grow"},_e={class:"font-baloo text-xs leading-5 text-gray-300"},pe={class:"shadow min-w-[120px] divide-y divide-secondary whitespace-nowrap rounded-lg border-2 border-black-100 bg-white py-1 px-3 text-black-100"},fe={class:"py-2"},he=["onClick"],me=e("i",{class:"far fa-edit"},null,-1),ve=f(" \u7DE8\u8F2F\u8CBC\u6587 "),ke=[me,ve],ge={class:"py-2"},be=["onClick"],xe=e("i",{class:"fas fa-trash-alt mr-1"},null,-1),ye=f(" \u522A\u9664\u8CBC\u6587 "),we=[xe,ye],Ce=["innerHTML"],Me=["src"],$e=e("i",{class:"fa-regular fa-thumbs-up mr-1"},null,-1),Be=e("span",{class:"inline-block text-base leading-[22px]"},"\u6210\u70BA\u7B2C\u4E00\u500B\u6309\u8B9A\u7684\u670B\u53CB",-1),He=[$e,Be],Le=e("i",{class:"fa-regular fa-thumbs-up mr-1"},null,-1),De={class:"inline-block font-baloo leading-[22px] text-black-100"},Te={class:"mt-[18px] flex items-center"},je=["src"],Ee={class:"flex flex-grow"},Fe=f(" \u7559\u8A00 "),ze={class:"mb-1 flex items-center"},Se=["src"],Ve={class:"flex-grow"},Ne={class:"text-xs leading-5 text-gray-300"},Pe={class:"shadow min-w-[120px] divide-y divide-secondary whitespace-nowrap rounded-lg border-2 border-black-100 bg-white py-1 px-3 text-black-100"},qe={class:"py-2"},Ae=["onClick"],Ie=e("i",{class:"far fa-edit"},null,-1),Oe=f(" \u7DE8\u8F2F\u7559\u8A00 "),Ue=[Ie,Oe],Ge={class:"py-2"},Re=["onClick"],Je=e("i",{class:"fas fa-trash-alt mr-1"},null,-1),Ke=f(" \u522A\u9664\u7559\u8A00 "),Qe=[Je,Ke],We={class:"break-all pl-[52px]"},rs={props:{post:{type:Object,required:!0}},emits:["post-like","delete-like","post-message","delete-post","delete-message"],setup(r,{emit:t}){const i=r,o=M(!1),l=M(""),{post:s}=K(i),z=Q(()=>k.value._id===s.value.user._id),$=async n=>await b({icon:"question",title:n,showCancelButton:!0,focusConfirm:!1,confirmButtonText:"\u78BA\u5B9A",cancelButtonText:"\u53D6\u6D88",confirmButtonColor:"#EF4444",timer:0}),B=()=>{try{ee(s.value._id),t("post-like",s.value._id)}catch(n){b({title:C(n.message),icon:"error"}),T(s.value._id)}},S=()=>{try{T(s.value._id),t("delete-like",s.value._id)}catch(n){b({title:C(n.message),icon:"error"})}},V=()=>{if(s.value.likes.includes(k.value._id))return S();B()},N=async()=>{try{if(!l.value)return;o.value=!0;const{data:n}=await se(s.value._id,{content:l.value});t("post-message",{postId:s.value._id,message:n}),l.value=""}catch(n){b({title:C(n.message),icon:"error"})}finally{o.value=!1}},P=()=>{alert("\u7DE8\u8F2F\u8CBC\u6587\u529F\u80FD\uFF0C\u65BD\u5DE5\u4E2D...")},q=async()=>{(await $("\u78BA\u5B9A\u8981\u522A\u9664\u9019\u7BC7\u8CBC\u6587\uFF1F")).isConfirmed&&t("delete-post",s.value._id)},A=()=>{alert("\u7DE8\u8F2F\u7559\u8A00\u529F\u80FD\uFF0C\u65BD\u5DE5\u4E2D...")},I=async n=>{(await $("\u78BA\u5B9A\u8981\u522A\u9664\u9019\u5247\u7559\u8A00\uFF1F")).isConfirmed&&(te(n),t("delete-message",n,s.value._id))};return(n,c)=>{const H=L("router-link"),O=L("Button"),x=D("img-avatar-fallback"),U=D("img-fallback");return u(),p("li",ie,[e("div",ce,[v(e("img",{src:a(s).user.avatar,alt:"avatar",class:"mr-4 h-[45px] w-[45px] flex-shrink-0 rounded-full object-cover"},null,8,de),[[x]]),e("div",ue,[y(H,{to:{name:"User",params:{userId:a(s).user._id}},class:"font-bold text-black-100 hover:text-primary hover:underline"},{default:h(()=>[f(m(a(s).user.name),1)]),_:1},8,["to"]),e("div",_e,m(a(j)(a(s).createdAt)),1)]),a(z)?(u(),w(E,{key:0,class:"ml-3 flex-shrink-0"},{default:h(()=>[e("ul",pe,[e("li",fe,[e("button",{class:"block w-full rounded-md p-2 hover:bg-secondary/70",onClick:_(P,["stop"]),onMousedown:c[0]||(c[0]=_(()=>{},["prevent"]))},ke,40,he)]),e("li",ge,[e("button",{class:"block w-full rounded-md p-2 text-red-500 hover:bg-secondary/70",onClick:_(q,["stop"]),onMousedown:c[1]||(c[1]=_(()=>{},["prevent"]))},we,40,be)])])]),_:1})):g("",!0)]),e("p",{class:"whitespace-pre-wrap text-black-100",innerHTML:a(oe)(a(s).content)},null,8,Ce),a(s).image?v((u(),p("img",{key:0,class:"mt-4 rounded-lg object-cover",src:a(s).image,alt:"post image"},null,8,Me)),[[U]]):g("",!0),a(s).likes.length?(u(),p("button",{key:2,class:"mt-4 text-xl leading-none text-primary",onClick:V},[Le,e("span",De,m(a(s).likes.length),1)])):(u(),p("button",{key:1,class:"mt-4 text-xl leading-none text-gray-300",onClick:B},He)),e("div",Te,[v(e("img",{src:a(k).avatar,alt:"avatar",class:"mr-2 h-10 w-10 flex-shrink-0 rounded-full object-cover"},null,8,je),[[x]]),e("div",Ee,[v(e("input",{"onUpdate:modelValue":c[2]||(c[2]=d=>l.value=d),type:"text",class:"w-[71.11%] rounded-none border-y-2 border-l-2 border-black-100 py-2 px-4 text-black-100",placeholder:"\u7559\u8A00..."},null,512),[[W,l.value,void 0,{trim:!0}]]),y(O,{loading:o.value,class:F(["w-[28.89%] flex-shrink-0 border-2 border-black-100 bg-primary font-azeret text-white hover:bg-yellow-100 hover:text-black-100",{"cursor-not-allowed":!l.value}]),onClick:N},{default:h(()=>[Fe]),_:1},8,["loading","class"])])]),a(s).messages.length?(u(),w(Z,{key:3,tag:"ul",name:"slide",class:"mt-[18px] space-y-4 text-black-100"},{default:h(()=>[(u(!0),p(X,null,Y(a(s).messages,d=>(u(),p("li",{key:d._id,class:"rounded-[12px] bg-secondary/30 py-[18px] px-4"},[e("div",ze,[v(e("img",{src:d.user.avatar,alt:"avatar",class:"mr-3 h-10 w-10 flex-shrink-0 rounded-full object-cover"},null,8,Se),[[x]]),e("div",Ve,[y(H,{to:{name:"User",params:{userId:d.user._id}},class:"hover:text-primary hover:underline"},{default:h(()=>[f(m(d.user.name),1)]),_:2},1032,["to"]),e("div",Ne,m(a(j)(d.createdAt)),1)]),d.user._id===a(k)._id?(u(),w(E,{key:0,class:"ml-3 flex-shrink-0"},{default:h(()=>[e("ul",Pe,[e("li",qe,[e("button",{class:"block w-full rounded-md p-2 hover:bg-secondary/70",onClick:_(A,["stop"]),onMousedown:c[3]||(c[3]=_(()=>{},["prevent"]))},Ue,40,Ae)]),e("li",Ge,[e("button",{class:"block w-full rounded-md p-2 text-red-500 hover:bg-secondary/70",onClick:_(Xe=>I(d._id),["stop"]),onMousedown:c[4]||(c[4]=_(()=>{},["prevent"]))},Qe,40,Re)])])]),_:2},1024)):g("",!0)]),e("p",We,m(d.content),1)]))),128))]),_:1})):g("",!0)])}}};export{rs as _,ls as a,as as b,ns as c,os as d,ts as p};
