import{r,p as B,K as Y,o as A,a as G,s as J,b as o,c as i,k as u,n as S,F as m,l as O,x as P,u as h,g as E,d as T,e as D,w as Q,f as X,_ as Z,h as U,i as ee,L as ae}from"./index.a4d8b40b.js";import{h as se,d as te,a as le}from"./post.f8263ef8.js";import{g as oe,d as re,p as ne}from"./track.7de0ddbc.js";import{s as ce,g as ie}from"./swal.5a8fdb95.js";import{_ as ue,a as de,p as ve,d as fe,b as ge}from"./PostFilter.8ac9cc4c.js";import{E as N}from"./EmptyPostCard.cdf9b3e6.js";import"./plugin-vue_export-helper.21dcd24c.js";const pe=(y=0)=>y.toString().replace(/\B(?=(\d{3})+$)/g,","),me={class:"relative isolate mb-4 after:absolute after:right-1 after:top-1 after:z-[-1] after:h-full after:w-full after:rounded-lg after:border-2 after:border-black-100 after:content-['']"},_e=U("\u8F09\u5165\u4E2D..."),ke={class:"min-h-[80px] w-[20%] flex-shrink-0 border-r-2 border-black-100 lg:w-[15%]"},he=["src"],ye={class:"flex flex-grow items-center p-4"},we={class:"flex-grow pr-5"},be={class:"font-bold"},xe=U("\u8F09\u5165\u4E2D..."),Ie={key:0,class:"space-y-5"},Le={key:2,class:"mt-5 flex justify-center"},Ee={props:{userId:{type:String,required:!0}},setup(y){const n=y,_=r(!1),c=r(!1),d=r(!1),w=r("desc"),C=r(""),k=r(1),g=r([]),t=r([]),v=r({}),f=r({}),{user:b}=ee(),V=B(()=>b.value._id===n.userId),x=B(()=>g.value.some(e=>e._id===n.userId)),H=async e=>{try{_.value=!0,c.value=!0;const[a,s,l]=await Promise.all([oe(),ae(e),I(e)]);g.value=a.data.map(p=>p.tracking),v.value=s.data,t.value=l.data,f.value=l.meta}finally{_.value=!1,c.value=!1}},I=async e=>{const{data:a}=await se(e,{sort:w.value,q:C.value,page:k.value});return a},L=async({isScrolling:e=!1,reset:a=!1}={})=>{try{e?d.value=!0:c.value=!0,a&&(k.value=1,t.value=[]);const{data:s,meta:l}=await I(n.userId);t.value.push(...s),f.value=l}finally{c.value=!1,d.value=!1}},$=()=>{try{if(x.value){re(n.userId);const e=g.value.findIndex(a=>a._id===n.userId);g.value.splice(e,1),v.value.tracking--}else ne(n.userId),g.value.push(v.value),v.value.tracking++}catch(e){ce({title:ie(e.message),icon:"error"})}},j=e=>{ve({postId:e,userId:b.value._id,posts:t.value})},K=e=>{fe({postId:e,userId:b.value._id,posts:t.value})},q=async e=>{const a=t.value.findIndex(s=>s._id===e);if(~a&&t.value.splice(a,1),await te(e),!c.value&&!d.value&&t.value.length<f.value.total-1)try{d.value=!0;const{data:s,meta:l}=await I(n.userId);t.value.push(s.pop()),f.value=l}finally{d.value=!1}},z=({postId:e,message:a})=>{ge({postId:e,message:a,posts:t.value})},F=async(e,a)=>{const s=t.value.find(p=>p._id===a),l=s.messages.findIndex(p=>p._id===e);~l&&s.messages.splice(l,1),await le(e)},R=e=>{w.value=e,L({reset:!0})},W=e=>{C.value=e,L({reset:!0})},M=()=>{c.value||d.value||f.value.currentPage>=f.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(k.value++,L({isScrolling:!0}))};return Y((e,a)=>{const{params:{userId:s}}=e;n.userId!==s&&(k.value=1,H(s))}),A(()=>{window.addEventListener("scroll",M)}),G(()=>{window.removeEventListener("scroll",M)}),H(n.userId),(e,a)=>{const s=J("img-avatar-fallback");return o(),i(m,null,[u("div",me,[u("div",{class:S(["flex rounded-lg border-2 border-black-100 bg-white",{"min-h-[80px] items-center justify-center":_.value}])},[_.value?(o(),i(m,{key:0},[_e],64)):(o(),i(m,{key:1},[u("div",ke,[O(u("img",{src:v.value.avatar,class:"h-full w-full rounded-l-lg object-cover",alt:"avatar"},null,8,he),[[s]])]),u("div",ye,[u("div",we,[u("div",be,P(v.value.name),1),u("p",null,P(h(pe)(v.value.tracking))+" \u4EBA\u8FFD\u8E64",1)]),h(V)?E("",!0):(o(),i("button",{key:0,class:S(["flex-shrink-0 rounded-lg border-2 border-black-100 px-8 font-bold leading-8 text-black-100 shadow-200",h(x)?"bg-secondary":"bg-yellow-100"]),onClick:$},P(h(x)?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3))])],64))],2)]),T(ue,{class:"mb-4",loading:c.value,sort:w.value,onChangeSort:R,onChangeKeyword:W},null,8,["loading","sort"]),c.value?(o(),D(N,{key:0},{default:Q(()=>[xe]),_:1})):(o(),i(m,{key:1},[t.value.length?(o(),i("ul",Ie,[(o(!0),i(m,null,X(t.value,l=>(o(),D(de,{key:l._id,post:l,onPostLike:j,onPostMessage:z,onDeleteLike:K,onDeletePost:q,onDeleteMessage:F},null,8,["post"]))),128))])):(o(),D(N,{key:1}))],64)),d.value?(o(),i("div",Le,[T(Z,{color:"text-primary"})])):E("",!0)],64)}}};export{Ee as default};
