import{r,m as T,u as L,N as W,o as Y,a as A,q as J,b as o,c as v,j as i,n as B,F as m,k as Q,x as D,s as h,f as S,d as E,e as y,w as N,T as X,_ as Z,h as j,O as ee,g as ae}from"./index.c0c28979.js";import{h as se,d as te,a as le}from"./post.2720bc85.js";import{g as oe,d as re,p as ne}from"./track.910db8c0.js";import{s as ce,g as ie}from"./swal.5a8fdb95.js";import{_ as ue,a as de,p as ve,d as fe,b as ge}from"./PostFilter.5da0f865.js";import{E as $}from"./EmptyPostCard.d587914f.js";import"./plugin-vue_export-helper.21dcd24c.js";const pe=(w=0)=>w.toString().replace(/\B(?=(\d{3})+$)/g,","),me={class:"relative isolate mb-4 after:absolute after:right-1 after:top-1 after:z-[-1] after:h-full after:w-full after:rounded-lg after:border-2 after:border-black-100 after:content-['']"},_e=j("\u8F09\u5165\u4E2D..."),ke={class:"min-h-[80px] w-[20%] flex-shrink-0 border-r-2 border-black-100 lg:w-[15%]"},he=["src"],ye={class:"flex flex-grow items-center p-4"},we={class:"flex-grow pr-5"},be={class:"font-bold"},xe=j("\u8F09\u5165\u4E2D..."),Ie={key:2,class:"mt-5 flex justify-center"},Be={props:{userId:{type:String,required:!0}},setup(w){const n=w,_=r(!1),c=r(!1),u=r(!1),b=r("desc"),C=r(""),k=r(1),g=r([]),t=r([]),d=r({}),f=r({}),U=T(()=>L.value._id===n.userId),x=T(()=>g.value.some(e=>e._id===n.userId)),H=async e=>{try{_.value=!0,c.value=!0;const[a,s,l]=await Promise.all([oe(),ee(e),I(e)]);g.value=a.data.map(p=>p.tracking),d.value=s.data,t.value=l.data,f.value=l.meta}finally{_.value=!1,c.value=!1}},I=async e=>{const{data:a}=await se(e,{sort:b.value,q:C.value,page:k.value});return a},P=async({isScrolling:e=!1,reset:a=!1}={})=>{try{e?u.value=!0:c.value=!0,a&&(k.value=1,t.value=[]);const{data:s,meta:l}=await I(n.userId);t.value.push(...s),f.value=l}finally{c.value=!1,u.value=!1}},V=()=>{try{if(x.value){re(n.userId);const e=g.value.findIndex(a=>a._id===n.userId);g.value.splice(e,1),d.value.tracking--}else ne(n.userId),g.value.push(d.value),d.value.tracking++}catch(e){ce({title:ie(e.message),icon:"error"})}},q=e=>{ve({postId:e,userId:L.value._id,posts:t.value})},z=e=>{fe({postId:e,userId:L.value._id,posts:t.value})},F=async e=>{const a=t.value.findIndex(s=>s._id===e);if(~a&&t.value.splice(a,1),await te(e),!c.value&&!u.value&&t.value.length<f.value.total-1)try{u.value=!0;const{data:s,meta:l}=await I(n.userId);t.value.push(s.pop()),f.value=l}finally{u.value=!1}},K=({postId:e,message:a})=>{ge({postId:e,message:a,posts:t.value})},G=async(e,a)=>{const s=t.value.find(p=>p._id===a),l=s.messages.findIndex(p=>p._id===e);~l&&s.messages.splice(l,1),await le(e)},O=e=>{b.value=e,P({reset:!0})},R=e=>{C.value=e,P({reset:!0})},M=()=>{c.value||u.value||f.value.currentPage>=f.value.lastPage||window.scrollY+window.innerHeight>=document.body.scrollHeight-100&&(k.value++,P({isScrolling:!0}))};return W((e,a)=>{const{params:{userId:s}}=e;n.userId!==s&&(k.value=1,H(s))}),Y(()=>{window.addEventListener("scroll",M)}),A(()=>{window.removeEventListener("scroll",M)}),H(n.userId),(e,a)=>{const s=J("img-avatar-fallback");return o(),v(m,null,[i("div",me,[i("div",{class:B(["flex rounded-lg border-2 border-black-100 bg-white",{"min-h-[80px] items-center justify-center":_.value}])},[_.value?(o(),v(m,{key:0},[_e],64)):(o(),v(m,{key:1},[i("div",ke,[Q(i("img",{src:d.value.avatar,class:"h-full w-full rounded-l-lg object-cover",alt:"avatar"},null,8,he),[[s]])]),i("div",ye,[i("div",we,[i("div",be,D(d.value.name),1),i("p",null,D(h(pe)(d.value.tracking))+" \u4EBA\u8FFD\u8E64",1)]),h(U)?S("",!0):(o(),v("button",{key:0,class:B(["flex-shrink-0 rounded-lg border-2 border-black-100 px-8 font-bold leading-8 text-black-100 shadow-200",h(x)?"bg-secondary":"bg-yellow-100"]),onClick:V},D(h(x)?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3))])],64))],2)]),E(ue,{class:"mb-4",loading:c.value,sort:b.value,onChangeSort:O,onChangeKeyword:R},null,8,["loading","sort"]),c.value?(o(),y($,{key:0},{default:N(()=>[xe]),_:1})):(o(),v(m,{key:1},[t.value.length?(o(),y(X,{key:0,tag:"ul",name:"fade",class:"space-y-5"},{default:N(()=>[(o(!0),v(m,null,ae(t.value,l=>(o(),y(de,{key:l._id,post:l,onPostLike:q,onPostMessage:K,onDeleteLike:z,onDeletePost:F,onDeleteMessage:G},null,8,["post"]))),128))]),_:1})):(o(),y($,{key:1}))],64)),u.value?(o(),v("div",Ie,[E(Z,{color:"text-primary"})])):S("",!0)],64)}}};export{Be as default};
