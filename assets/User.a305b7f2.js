import{r as n,t as j,I as C,J as K,j as U,o as a,c,k as i,l as q,m as _,u as f,K as z,p as F,n as R,a as $,b,d as J,F as h,e as A,g as G,L as O,f as Q}from"./index.9d75d83d.js";import{e as W}from"./post.347c5e29.js";import{g as X,d as Y,p as Z}from"./track.36661574.js";import{s as ee,g as ae}from"./swal.db038e00.js";import{_ as se,a as te,p as oe,d as re,b as le}from"./PostFilter.8c87bc8f.js";import{E as D}from"./EmptyPostCard.eefc941b.js";import"./plugin-vue_export-helper.21dcd24c.js";const ne={class:"relative isolate mb-4 after:absolute after:right-1 after:top-1 after:z-[-1] after:h-full after:w-full after:rounded-lg after:border-2 after:border-black-100 after:content-['']"},ce={class:"flex rounded-lg border-2 border-black-100 bg-white"},ie={class:"min-h-[80px] w-[20%] flex-shrink-0 border-r-2 border-black-100 lg:w-[15%]"},ue=["src"],de={key:0,class:"flex flex-grow items-center justify-center"},ve={key:1,class:"flex flex-grow items-center p-4"},fe={class:"flex-grow pr-5"},pe={class:"font-bold"},ge=Q("\u8F09\u5165\u4E2D..."),me={key:0,class:"space-y-5"},Le={props:{userId:{type:String,required:!0}},setup(I){const P=I,p=n(!1),u=n(!1),g=n("desc"),y=n(""),d=n([]),t=n([]),o=n({}),{user:m}=G(),{userId:s}=j(P),T=C(()=>m.value._id===s.value),k=C(()=>d.value.some(e=>e._id===s.value)),w=async e=>{try{p.value=!0,u.value=!0;const[r,l,v]=await Promise.all([X(),O(e),x()]);d.value=r.data.map(V=>V.tracking),o.value=l.data,t.value=v.data}finally{p.value=!1,u.value=!1}},x=async()=>await W(s.value,{sort:g.value,q:y.value}),L=async()=>{u.value=!0;const{data:e}=await x();t.value=e,u.value=!1},B=()=>{try{if(k.value){Y(s.value);const e=d.value.findIndex(r=>r._id===s.value);d.value.splice(e,1),o.value.tracking--}else Z(s.value),d.value.push(o.value),o.value.tracking++}catch(e){ee({title:ae(e.message),icon:"error"})}},S=e=>{oe({postId:e,userId:m.value._id,posts:t.value})},E=e=>{re({postId:e,userId:m.value._id,posts:t.value})},H=({postId:e,message:r})=>{le({postId:e,message:r,posts:t.value})},M=e=>{g.value=e,L()},N=e=>{y.value=e,L()};return K((e,r)=>{const{params:{userId:l}}=e;s.value!==l&&(w(l),s.value=l)}),w(s.value),(e,r)=>{const l=U("img-avatar-fallback");return a(),c(h,null,[i("div",ne,[i("div",ce,[i("div",ie,[q(i("img",{src:o.value.avatar,class:"h-full w-full rounded-l-lg object-cover",alt:"avatar"},null,8,ue),[[l]])]),p.value?(a(),c("div",de," \u8F09\u5165\u4E2D... ")):(a(),c("div",ve,[i("div",fe,[i("div",pe,_(o.value.name),1),i("p",null,_(f(z)(o.value.tracking))+" \u4EBA\u8FFD\u8E64",1)]),f(T)?R("",!0):(a(),c("button",{key:0,class:F(["flex-shrink-0 rounded-lg border-2 border-black-100 px-8 font-bold leading-8 text-black-100 shadow-200",f(k)?"bg-secondary":"bg-yellow-100"]),onClick:B},_(f(k)?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3))]))])]),$(se,{class:"mb-4",loading:u.value,sort:g.value,onChangeSort:M,onChangeKeyword:N},null,8,["loading","sort"]),u.value?(a(),b(D,{key:0},{default:J(()=>[ge]),_:1})):(a(),c(h,{key:1},[t.value.length?(a(),c("ul",me,[(a(!0),c(h,null,A(t.value,v=>(a(),b(te,{key:v._id,post:v,onPostLike:S,onPostMessage:H,onDeleteLike:E},null,8,["post"]))),128))])):(a(),b(D,{key:1}))],64))],64)}}};export{Le as default};
